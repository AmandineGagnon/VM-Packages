$ErrorActionPreference = 'Stop'
Import-Module vm.common -Force -DisableNameChecking

try {
    $toolName = 'malware-jail'
    $category = 'Javascript'

    $zipUrl = 'https://github.com/HynekPetrak/malware-jail/archive/52d580bd76e0e0fc3ff2543758bb8fc45355c668.zip'
    $zipSha256 = '24a9312635b95e4ccc41d5719a67f0db23cd577a648f33c7dab5d47c249531fd'
    # Install dependencies with npm when running shortcut as we ignore errors below
    $powershellCommand = "npm install; node jailme.js -h -b list"

    $toolDir = VM-Install-Raw-GitHub-Repo $toolName $category $zipUrl $zipSha256 -powershellCommand $powershellCommand

} catch {
    VM-Write-Log-Exception $_
}

# Prevent the following warning from failing the package: "npm WARN deprecated request@2.79.0"
$ErrorActionPreference = 'Continue'
# Get absolute path as npm is not in path until Powershell is restarted
$npmPath = Join-Path ${Env:ProgramFiles} "\nodejs\npm.cmd" -Resolve
# Install tool dependencies with npm
Set-Location $toolDir; & "$npmPath" install | Out-Null
